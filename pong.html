<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pong – Miles Weatherman</title>

    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="images/MW-favicon-blackBackground.png" />

    <style>
        body {
            margin: 0;
            background: black;
            overflow: hidden;
            padding-bottom: env(safe-area-inset-bottom);
            font-family: var(--body-font);
        }

        #pongCanvas {
            display: block;
            position: absolute;
            top: var(--nav-height);
            left: 50%;
            transform: translateX(-50%);
            background: black;
            touch-action: none;
        }

        /* Scoreboard: same format + placement, Times New Roman */
        #scoreboard {
            position: fixed;
            top: var(--nav-height);
            width: 100%;
            text-align: center;
            color: white;
            font-family: "Times New Roman", Times, serif;
            font-weight: 700;
            font-size: 2rem;
            letter-spacing: 0.6rem;
            z-index: 10;
            pointer-events: none;
        }

        /* Countdown/message: Times New Roman */
        #message {
            position: fixed;
            top: calc(50% + var(--nav-height) / 2);
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: "Times New Roman", serif;
            font-weight: 700;
            font-size: 3rem;
            opacity: 0;
            transition: opacity 0.35s ease;
            pointer-events: none;
            z-index: 10;
        }

        /* Audio controls bottom-left, outline icons, pure white */
        #audioControls {
            position: fixed;
            left: 14px;
            /* Safe-area aware + lifted so it never clips */
            bottom: calc(env(safe-area-inset-bottom) + 22px);
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 20;
            user-select: none;
        }

            #audioControls button {
                background: none;
                border: none;
                padding: 2px;
                cursor: pointer;
                line-height: 0;
            }

        /* Outline SVG icons in pure white */
        .icon {
            width: 20px;
            height: 20px;
            stroke: white;
            fill: none;
            stroke-width: 2;
            stroke-linecap: square;
            stroke-linejoin: miter;
            display: block;
        }

        /* Pure white slider */
        #audioControls input[type="range"] {
            width: 130px;
            background: transparent;
            accent-color: white;
            cursor: pointer;
        }

            #audioControls input[type="range"]::-webkit-slider-runnable-track {
                height: 3px;
                background: white;
            }

            #audioControls input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 12px;
                height: 12px;
                border-radius: 0;
                background: white;
                margin-top: -4.5px;
            }

            #audioControls input[type="range"]::-moz-range-track {
                height: 3px;
                background: white;
            }

            #audioControls input[type="range"]::-moz-range-thumb {
                width: 12px;
                height: 12px;
                border-radius: 0;
                background: white;
                border: none;
            }

        @media (max-width: 768px) {
            #pongCanvas {
                width: 95vw;
                height: auto;
            }

            #scoreboard {
                font-size: 1.5rem;
                letter-spacing: 0.4rem;
            }

            #audioControls input[type="range"] {
                width: 95px;
            }

            #audioControls {
                bottom: calc(env(safe-area-inset-bottom) + 18px);
            }
        }
    </style>
</head>

<body>

    <nav class="top-nav">
        <li class="nav-item"><a href="index.html">RESUME</a></li>
        <li class="nav-item"><a href="projects.html">PROJECTS</a></li>
        <li class="nav-item active">
            <a href="pong.html" aria-label="Pong">
                <img class="nav-mw" src="images/MW-favicon-blackBackground.png" alt="MW Icon">
            </a>
        </li>
    </nav>

    <div id="scoreboard">0   0</div>
    <div id="message"></div>

    <canvas id="pongCanvas" width="800" height="500"></canvas>

    <div id="audioControls">
        <button id="playPauseBtn" aria-label="Play or pause">
            <!-- Starts as PAUSE because we attempt auto-play on load -->
            <svg id="pauseIcon" class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            <svg id="playIcon" class="icon" viewBox="0 0 24 24" aria-hidden="true" style="display:none;">
                <polygon points="7,5 19,12 7,19"></polygon>
            </svg>
        </button>

        <input id="volSlider" type="range" min="0" max="1" step="0.01" value="0.8" aria-label="Volume">
    </div>

    <script>
        /* ============================================================
           GAME CONSTANTS (original feel)
           ============================================================ */
        const canvas = document.getElementById('pongCanvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        const paddleW = 10;
        const paddleH = 80;

        const player = { x: 20, y: H / 2 - paddleH / 2 };
        const ai = { x: W - 30, y: H / 2 - paddleH / 2 };

        const ballSize = 12;
        let ball = { x: W / 2, y: H / 2, dx: 0, dy: 0 };
        let ballSpeed = 5.5;
        let accelerating = false;

        let pScore = 0;
        let aScore = 0;
        const AI_REACTION = 0.020;

        /* ============================================================
           AUDIO PLAYLIST (auto-start + play/pause)
           ============================================================ */
        const tracks = [
            "music/111525_Second_Demo.mp3", // play first
            "music/102125_First_Demo.mp3"
        ];
        let currentTrack = 0;

        const audio = new Audio(tracks[currentTrack]);
        audio.preload = "auto";
        audio.loop = false;
        audio.volume = 0.8;

        // try auto-start; if blocked, play button will start it
        audio.play().catch(() => { });

        audio.addEventListener("ended", () => {
            currentTrack = (currentTrack + 1) % tracks.length;
            audio.src = tracks[currentTrack];
            audio.play().catch(() => { });
        });

        // UI controls
        const playPauseBtn = document.getElementById("playPauseBtn");
        const playIcon = document.getElementById("playIcon");
        const pauseIcon = document.getElementById("pauseIcon");
        const volSlider = document.getElementById("volSlider");

        function syncIcons() {
            if (audio.paused) {
                pauseIcon.style.display = "none";
                playIcon.style.display = "block";
            } else {
                playIcon.style.display = "none";
                pauseIcon.style.display = "block";
            }
        }
        syncIcons();

        playPauseBtn.addEventListener("click", () => {
            if (audio.paused) audio.play().catch(() => { });
            else audio.pause();
            syncIcons();
        });

        volSlider.addEventListener("input", () => {
            audio.volume = parseFloat(volSlider.value);
        });

        /* ============================================================
           COUNTDOWN (“3,2,1”)
           ============================================================ */
        function showMessage(txt) {
            const m = document.getElementById("message");
            m.textContent = txt;
            m.style.opacity = "1";
        }
        function hideMessage() {
            document.getElementById("message").style.opacity = "0";
        }

        function countdownStart() {
            showMessage("3");
            setTimeout(() => {
                showMessage("2");
                setTimeout(() => {
                    showMessage("1");
                    setTimeout(() => {
                        hideMessage();
                        launchBall();
                    }, 700);
                }, 700);
            }, 700);
        }

        /* ============================================================
           GAME LOGIC
           ============================================================ */
        function launchBall() {
            let angle = Math.random() * Math.PI / 4 - Math.PI / 8;
            ballSpeed = 5.5;
            accelerating = true;
            ball.dx = ballSpeed * (Math.random() < 0.5 ? 1 : -1);
            ball.dy = ballSpeed * Math.sin(angle);
        }

        function resetBall() {
            ball.x = W / 2;
            ball.y = H / 2;
            ball.dx = 0;
            ball.dy = 0;
            accelerating = false;
            countdownStart();
        }

        function update() {
            if (accelerating) ballSpeed += 0.002;

            ball.x += ball.dx;
            ball.y += ball.dy;

            /* Wall collisions (anti-stick clamp) */
            if (ball.y < 0) {
                ball.y = 0;
                ball.dy *= -1;
            }
            if (ball.y + ballSize > H) {
                ball.y = H - ballSize;
                ball.dy *= -1;
            }

            /* Paddle collisions */
            if (ball.x < player.x + paddleW &&
                ball.x > player.x &&
                ball.y + ballSize > player.y &&
                ball.y < player.y + paddleH) {
                bounce(player);
                ball.x = player.x + paddleW; // nudge out to prevent sticking
            }

            if (ball.x + ballSize > ai.x &&
                ball.x + ballSize < ai.x + paddleW &&
                ball.y + ballSize > ai.y &&
                ball.y < ai.y + paddleH) {
                bounce(ai);
                ball.x = ai.x - ballSize; // nudge out to prevent sticking
            }

            /* Scoring */
            if (ball.x < 0) {
                aScore++;
                updateScore();
                resetBall();
            }
            if (ball.x + ballSize > W) {
                pScore++;
                updateScore();
                resetBall();
            }

            moveAI();
        }

        function bounce(p) {
            let pCenter = p.y + paddleH / 2;
            let bCenter = ball.y + ballSize / 2;
            let rel = (bCenter - pCenter) / (paddleH / 2);
            let angle = rel * (Math.PI / 4);
            let dir = (p === player) ? 1 : -1;

            ball.dx = dir * ballSpeed * Math.cos(angle);
            ball.dy = ballSpeed * Math.sin(angle);
        }

        function moveAI() {
            const target = ball.y + ballSize / 2;
            const diff = target - (ai.y + paddleH / 2);
            ai.y += Math.max(Math.min(diff * AI_REACTION * 100, 4.2), -4.2);

            if (ai.y < 0) ai.y = 0;
            if (ai.y + paddleH > H) ai.y = H - paddleH;
        }

        function updateScore() {
            document.getElementById("scoreboard").textContent =
                `${pScore}   ${aScore}`;
        }

        /* ============================================================
           INPUT (original)
           ============================================================ */
        canvas.addEventListener("mousemove", e => {
            const rect = canvas.getBoundingClientRect();
            player.y = e.clientY - rect.top - paddleH / 2;
            if (player.y < 0) player.y = 0;
            if (player.y + paddleH > H) player.y = H - paddleH;
        });

        canvas.addEventListener("touchmove", e => {
            const rect = canvas.getBoundingClientRect();
            player.y = e.touches[0].clientY - rect.top - paddleH / 2;
            if (player.y < 0) player.y = 0;
            if (player.y + paddleH > H) player.y = H - paddleH;
            e.preventDefault();
        }, { passive: false });

        /* ============================================================
           DRAW LOOP (no center line)
           ============================================================ */
        function draw() {
            ctx.clearRect(0, 0, W, H);

            ctx.fillStyle = "white";
            ctx.fillRect(player.x, player.y, paddleW, paddleH);
            ctx.fillRect(ai.x, ai.y, paddleW, paddleH);
            ctx.fillRect(ball.x, ball.y, ballSize, ballSize);
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        /* Start */
        resetBall();
        loop();
    </script>

</body>
</html>
